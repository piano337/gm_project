(function(){
'use strict';var C;function aa(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var da=aa(this);function ea(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}
var fa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function ha(a,b){if(b)a:{var c=da;a=a.split(".");for(var e=0;e<a.length-1;e++){var h=a[e];if(!(h in c))break a;c=c[h]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&fa(c,a,{configurable:!0,writable:!0,value:b})}}
ha("Symbol",function(a){function b(h){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c("jscomp_symbol_"+(h||"")+"_"+e++,h)}function c(h,m){this.g=h;fa(this,"description",{configurable:!0,writable:!0,value:m})}if(a)return a;c.prototype.toString=function(){return this.g};var e=0;return b});
ha("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var e=da[b[c]];"function"===typeof e&&"function"!=typeof e.prototype[a]&&fa(e.prototype,a,{configurable:!0,writable:!0,value:function(){return ia(ea(this))}})}return a});function ia(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function la(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:ea(a)}}function D(a,b){return Object.prototype.hasOwnProperty.call(a,b)}
ha("WeakMap",function(a){function b(g){this.g=(f+=Math.random()+1).toString();if(g){g=la(g);for(var k;!(k=g.next()).done;)k=k.value,this.set(k[0],k[1])}}function c(){}function e(g){var k=typeof g;return"object"===k&&null!==g||"function"===k}function h(g){if(!D(g,p)){var k=new c;fa(g,p,{value:k})}}function m(g){var k=Object[g];k&&(Object[g]=function(l){if(l instanceof c)return l;Object.isExtensible(l)&&h(l);return k(l)})}if(function(){if(!a||!Object.seal)return!1;try{var g=Object.seal({}),k=Object.seal({}),
l=new a([[g,2],[k,3]]);if(2!=l.get(g)||3!=l.get(k))return!1;l.delete(g);l.set(k,4);return!l.has(g)&&4==l.get(k)}catch(d){return!1}}())return a;var p="$jscomp_hidden_"+Math.random();m("freeze");m("preventExtensions");m("seal");var f=0;b.prototype.set=function(g,k){if(!e(g))throw Error("Invalid WeakMap key");h(g);if(!D(g,p))throw Error("WeakMap key fail: "+g);g[p][this.g]=k;return this};b.prototype.get=function(g){return e(g)&&D(g,p)?g[p][this.g]:void 0};b.prototype.has=function(g){return e(g)&&D(g,
p)&&D(g[p],this.g)};b.prototype.delete=function(g){return e(g)&&D(g,p)&&D(g[p],this.g)?delete g[p][this.g]:!1};return b});
ha("Map",function(a){function b(){var f={};return f.D=f.next=f.head=f}function c(f,g){var k=f.g;return ia(function(){if(k){for(;k.head!=f.g;)k=k.D;for(;k.next!=k.head;)return k=k.next,{done:!1,value:g(k)};k=null}return{done:!0,value:void 0}})}function e(f,g){var k=g&&typeof g;"object"==k||"function"==k?m.has(g)?k=m.get(g):(k=""+ ++p,m.set(g,k)):k="p_"+g;var l=f.h[k];if(l&&D(f.h,k))for(f=0;f<l.length;f++){var d=l[f];if(g!==g&&d.key!==d.key||g===d.key)return{id:k,list:l,index:f,j:d}}return{id:k,list:l,
index:-1,j:void 0}}function h(f){this.h={};this.g=b();this.size=0;if(f){f=la(f);for(var g;!(g=f.next()).done;)g=g.value,this.set(g[0],g[1])}}if(function(){if(!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),g=new a(la([[f,"s"]]));if("s"!=g.get(f)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var k=g.entries(),l=k.next();if(l.done||l.value[0]!=f||"s"!=l.value[1])return!1;l=k.next();return l.done||4!=l.value[0].x||
"t"!=l.value[1]||!k.next().done?!1:!0}catch(d){return!1}}())return a;var m=new WeakMap;h.prototype.set=function(f,g){f=0===f?0:f;var k=e(this,f);k.list||(k.list=this.h[k.id]=[]);k.j?k.j.value=g:(k.j={next:this.g,D:this.g.D,head:this.g,key:f,value:g},k.list.push(k.j),this.g.D.next=k.j,this.g.D=k.j,this.size++);return this};h.prototype.delete=function(f){f=e(this,f);return f.j&&f.list?(f.list.splice(f.index,1),f.list.length||delete this.h[f.id],f.j.D.next=f.j.next,f.j.next.D=f.j.D,f.j.head=null,this.size--,
!0):!1};h.prototype.clear=function(){this.h={};this.g=this.g.D=b();this.size=0};h.prototype.has=function(f){return!!e(this,f).j};h.prototype.get=function(f){return(f=e(this,f).j)&&f.value};h.prototype.entries=function(){return c(this,function(f){return[f.key,f.value]})};h.prototype.keys=function(){return c(this,function(f){return f.key})};h.prototype.values=function(){return c(this,function(f){return f.value})};h.prototype.forEach=function(f,g){for(var k=this.entries(),l;!(l=k.next()).done;)l=l.value,
f.call(g,l[1],l[0],this)};h.prototype[Symbol.iterator]=h.prototype.entries;var p=0;return h});ha("Math.hypot",function(a){return a?a:function(b){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var c,e,h;for(c=h=0;c<arguments.length;c++)h=Math.max(h,Math.abs(arguments[c]));if(1E100<h||1E-100>h){if(!h)return h;for(c=e=0;c<arguments.length;c++){var m=Number(arguments[c])/h;e+=m*m}return Math.sqrt(e)*h}for(c=e=0;c<arguments.length;c++)m=Number(arguments[c]),e+=m*m;return Math.sqrt(e)}});function E(a){this.message=a}E.prototype.toString=function(){return this.message};
function ma(a,b,c){this.handle=a.createProgram();a.g&&(b="#version 300 es\n"+b.replace(/attribute/g,"in").replace(/varying/g,"out"),c="#version 300 es\n"+c.replace(/varying/g,"in").replace(/gl_FragColor/g,"FragColor").replace(/texture2D/g,"texture").replace(/precision highp float;/g,"precision highp float;\n#define webgl2 true\nout vec4 FragColor;"));this.h=na(this,a,a.VERTEX_SHADER,b);this.g=na(this,a,a.FRAGMENT_SHADER,c);b=this.handle;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS))throw new E("Error linking shader:\n"+
a.getProgramInfoLog(b));a.validateProgram(b);if(!a.getProgramParameter(b,a.VALIDATE_STATUS))throw new E("Error validating shader:\n"+a.getProgramInfoLog(b));var e=this.handle,h,m,p={},f;c=a.getProgramParameter(e,a.ACTIVE_UNIFORMS);for(b=0;b<c;++b){var g=a.getActiveUniform(e,b);if(null!==g&&(h=g.name.replace(/\]/g,""))){for(f=p;null!==(m=/[.\[]/.exec(h));){var k=h.substr(0,m.index);f.hasOwnProperty(k)?f=f[k]:"."===m[0]?f=f[k]={}:f=f[k]=[];h=h.substr(m.index+1)}if(1<g.size){m=g.size;var l=Array(m);
for(k=0;k<m;++k){var d=g.name+"["+k+"]";d=oa(this,a,d,g);l[k]=d}f[h]=l}else d=oa(this,a,g.name,g),f[h]=d}}this.uniform=p}function na(a,b,c,e){c=b.createShader(c);b.shaderSource(c,e);b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))throw console.warn(e.split("\n")),new E("Error compiling shader:\n"+b.getShaderInfoLog(c));b.attachShader(a.handle,c);return c}ma.prototype.use=function(a){a.useProgram(this.handle);return this};
function pa(a,b){b.detachShader(a.handle,a.h);b.deleteShader(a.h);b.detachShader(a.handle,a.g);b.deleteShader(a.g);b.deleteProgram(a.handle)}
function oa(a,b,c,e){a=b.getUniformLocation(a.handle,c);switch(e.type){case b.FLOAT:return b.uniform1fv.bind(b,a);case b.FLOAT_VEC2:return b.uniform2fv.bind(b,a);case b.FLOAT_VEC3:return b.uniform3fv.bind(b,a);case b.FLOAT_VEC4:return b.uniform4fv.bind(b,a);case b.BOOL:case b.INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:return b.uniform1iv.bind(b,a);case b.BOOL_VEC2:case b.INT_VEC2:return b.uniform2iv.bind(b,a);case b.BOOL_VEC3:case b.INT_VEC3:return b.uniform3iv.bind(b,a);case b.BOOL_VEC4:case b.INT_VEC4:return b.uniform4iv.bind(b,
a);case b.FLOAT_MAT2:return b.uniformMatrix2fv.bind(b,a,!1);case b.FLOAT_MAT3:return b.uniformMatrix3fv.bind(b,a,!1);case b.FLOAT_MAT4:return b.uniformMatrix4fv.bind(b,a,!1);default:throw new E("Unknown data type for uniform "+c);}};function qa(a){var b=a[0],c=a[1];a=a[2];var e=1/Math.sqrt(b*b+c*c+a*a);return[e*b,e*c,e*a]}function F(a){var b=1/a[3];return[b*a[0],b*a[1],b*a[2]]}function ra(a,b){return[a*b[0],a*b[1],a*b[2]]}function G(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]}function sa(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function ta(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3]]}function ua(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}
function I(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+
a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]}function va(a,b,c){a=F(a);return qa(ua(G(F(b),a),G(F(c),a)))};function wa(a,b){this.width=a;this.height=b;this.fieldOfView=Math.PI/360*45;this.zNear=.1;this.zFar=100;this.updatePerspective();this.setCamera([0,0,5],[0,0,0],[0,1,0])}wa.prototype.updatePerspective=function(){var a=1/Math.tan(this.fieldOfView),b=this.zNear-this.zFar;this.projectionMatrix=[a*this.height/this.width,0,0,0,0,a,0,0,0,0,(this.zFar+this.zNear)/b,-1,0,0,2*this.zFar*this.zNear/b,0]};
wa.prototype.setCamera=function(a,b,c){a=G(a,b);var e=a[0],h=a[1],m=a[2];this.viewDist=Math.sqrt(e*e+h*h+m*m);a=qa(a);c=qa(ua(c,a));e=ua(a,c);c=[c[0],e[0],a[0],c[1],e[1],a[1],c[2],e[2],a[2]];c=[c[4]*c[8]-c[5]*c[7],c[2]*c[7]-c[1]*c[8],c[1]*c[5]-c[2]*c[4],c[5]*c[6]-c[3]*c[8],c[0]*c[8]-c[2]*c[6],c[2]*c[3]-c[0]*c[5],c[3]*c[7]-c[4]*c[6],c[1]*c[6]-c[0]*c[7],c[0]*c[4]-c[1]*c[3]];b=[c[0]*b[0]+c[1]*b[1]+c[2]*b[2],c[3]*b[0]+c[4]*b[1]+c[5]*b[2],c[6]*b[0]+c[7]*b[1]+c[8]*b[2]];this.modelMatrix=[c[0],c[1],c[2],
-b[0],c[3],c[4],c[5],-b[1],c[6],c[7],c[8],-b[2],0,0,0,1];this.viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,-this.viewDist,0,0,0,1];this.mvMatrix=I(this.viewMatrix,this.modelMatrix)};function xa(a,b,c){var e=.01*b,h=.01*c;c=Math.cos(e);b=Math.cos(h);e=Math.sin(e);h=Math.sin(h);a.modelMatrix=I(I([c,0,e,0,0,1,0,0,-e,0,c,0,0,0,0,1],[1,0,0,0,0,b,-h,0,0,h,b,0,0,0,0,1]),a.modelMatrix);a.mvMatrix=I(a.viewMatrix,a.modelMatrix)}
function ya(a,b,c){var e=.002*a.viewDist;a.modelMatrix=I([1,0,0,e*b,0,1,0,-e*c,0,0,1,0,0,0,0,1],a.modelMatrix);a.mvMatrix=I(a.viewMatrix,a.modelMatrix)}function za(a,b){a.viewDist*=Math.pow(1.01,b);a.viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,-a.viewDist,0,0,0,1];a.mvMatrix=I(a.viewMatrix,a.modelMatrix)}function Aa(a,b){var c=Math.cos(b);b=Math.sin(b);a.modelMatrix=I([c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1],a.modelMatrix);a.mvMatrix=I(a.viewMatrix,a.modelMatrix)};function Ba(a){return{color:a,alpha:1,o:60,size:.05}}function J(a){return{color:a.color,alpha:a.alpha,o:a.o,size:a.size}};function Ca(a,b,c,e){function h(g){m.removeEventListener("webglcontextcreationerror",h,!1);g.statusMessage&&(p=g.statusMessage)}var m=document.getElementById(a);if(!m)throw new E("No canvas element with id "+a);var p="Unknown";m.addEventListener("webglcontextcreationerror",h,!1);"undefined"!==typeof CindyJS._pluginRegistry.CindyXR&&(b.xrCompatible=!0);a=null;var f=document.createElement("canvas");window.WebGL2RenderingContext&&f.getContext("webgl2")&&(a=m.getContext("webgl2",b),a.g=!0,console.log("Loaded WebGL 2.0."));
a||(f=document.createElement("canvas"),window.WebGLRenderingContext&&m.getContext("webgl")&&(a=m.getContext("webgl",b),console.log("Loaded WebGL 1.0."),/[?&]frag_depth=0/.test(window.location.search)?this.F=null:(this.F=a.getExtension("EXT_frag_depth"))||console.log("EXT_frag_depth extension not supported.")));a||(a=m.getContext("experimental-webgl",b));if(!a)throw new E("Could not obtain a WebGL context.\nReason: "+p);m.removeEventListener("webglcontextcreationerror",h,!1);a.depthFunc(a.LEQUAL);
a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);this.canvas=m;this.width=m.width;this.height=m.height;this.gl=a;this.g=1;c&&c.Y&&(this.g=c.Y|0,1>this.g&&(this.g=1));if(1!==this.g){b=this.width*this.height*this.g;for(c=64;c*c<b;)c*=2;this.m=this.l=c;this.G=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.G);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.hint(a.GENERATE_MIPMAP_HINT,a.NICEST);a.texImage2D(a.TEXTURE_2D,
0,a.RGB,this.m,this.l,0,a.RGB,a.UNSIGNED_BYTE,null);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null);this.S=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.S);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.m,this.l);a.bindRenderbuffer(a.RENDERBUFFER,null);this.T=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.T);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.G,0);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,
a.RENDERBUFFER,this.S);b=a.checkFramebufferStatus(a.FRAMEBUFFER);if(b!==a.FRAMEBUFFER_COMPLETE)throw new E("Failed to create supersampling framebuffer. glCheckFramebufferStatus returned "+b);a.bindFramebuffer(a.FRAMEBUFFER,null);this.N=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.N);a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,1,1,-1,1,0,1,1,-1,1,0,-1,-1,0,0]),a.STATIC_DRAW);this.J=new ma(a,"precision highp float;\n\nattribute vec4 aPos;\nvarying vec2 vPos;\n\nvoid main(){\nvPos=aPos.zw;\ngl_Position=vec4(aPos.xy,0,1);\n}\n",
"precision highp float;\n\nuniform sampler2D uTexture;\nvarying vec2 vPos;\n\nvoid main(){\ngl_FragColor=texture2D(uTexture,vPos);\n}\n");this.H=a.getAttribLocation(this.J.handle,"aPos")}else this.m=this.width,this.l=this.height;this.C=new Da;this.M="uniform vec3 uAmbient;\nuniform mat4 uModelViewMatrix;\n\nvarying vec4 vColor;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;\n\nvec4 gColor;\nvec3 gPos;\nvec3 gEye;\nvec3 gNormal;\nvec3 gAccumDiffuse;\nvec3 gAccumSpecular;\n\nvoid commonLight(in vec4 lightPos,out vec3 lightDir,\nout float diffuseFactor,out float specularFactor){\nvec3 halfVector;\nfloat specularDot;\n\nlightDir=normalize(lightPos.xyz-lightPos.w*gPos);\nhalfVector=normalize(lightDir+gEye);\ndiffuseFactor=max(0.0,dot(gNormal,lightDir));\nspecularDot=max(0.0,dot(gNormal,halfVector));\n\n\nif(diffuseFactor==0.0)\nspecularFactor=0.0;\nelse\nspecularFactor=pow(specularDot,vShininess) *vSpecularReflectiveness;\n}\n\nvec4 flipY(in vec4 v){\nreturn vec4(v.x, -v.y,v.z,v.w);\n}\n\nvoid pointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\n\ngAccumDiffuse +=diffuse*diffuseFactor;\ngAccumSpecular+=specular*specularFactor;\n}\n\nvoid cameraPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(flipY(lightPos),diffuse,specular);\n}\n\nvoid worldPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(-uModelViewMatrix*lightPos,diffuse,specular);\n}\n\nvoid spotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\nvec3 spotDir;\nfloat spotCosAngle;\nfloat spotAttenuation;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\nspotDir=lightPos.w*spotPos.xyz-spotPos.w*lightPos.xyz;\nspotCosAngle=dot(-lightDir,normalize(spotDir));\nspotAttenuation=\nstep(spotCosCutoff,spotCosAngle) *pow(spotCosAngle,spotExponent);\n\n\ngAccumDiffuse +=spotAttenuation*diffuse*diffuseFactor;\ngAccumSpecular+=spotAttenuation*specular*specularFactor;\n}\n\nvoid cameraSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\nflipY(lightPos),flipY(spotPos),\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n\nvoid worldSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\n-uModelViewMatrix*lightPos, -uModelViewMatrix*spotPos,\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n"+
Fa(this.C)+"\n\n\n\n\n\nvoid shade(in vec3 position,in vec3 normal){\n\ngAccumDiffuse=vec3(0.0);\ngAccumSpecular=vec3(0.0);\n\n\ngPos=position;\ngEye= -normalize(position);\ngNormal=sign(dot(gEye,normal))*normal;\n\n\nlightScene();\n\n\n\nvec3 color= (uAmbient+gAccumDiffuse) *gColor.xyz\n+gAccumSpecular;\n\ncolor=clamp(color,0.0,1.0);\ngl_FragColor=vec4(color.xyz,gColor.w);\n}\n";this.camera=new wa(this.width,this.height);this.spheres=new K(this);this.cylinders=new N(this);this.triangles=new Ga(this);
this.B=J(P.K);this.v=J(P.line);this.u=J(P.L);this.V=[];this.backgroundColor=[1,1,1,1];e||(e=function(g,k,l,d){g.addEventListener(k,l,!!d)});new Ha(e,this.canvas,this.camera,this)}var P={K:J(Ba([1,0,0])),line:J(Ba([0,0,1])),L:J(Ba([0,1,0]))};Ca.prototype.clear=function(){this.spheres.clear();this.cylinders.clear();this.triangles.clear()};
Ca.prototype.A=function(){this.C.h&&(this.M="uniform vec3 uAmbient;\nuniform mat4 uModelViewMatrix;\n\nvarying vec4 vColor;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;\n\nvec4 gColor;\nvec3 gPos;\nvec3 gEye;\nvec3 gNormal;\nvec3 gAccumDiffuse;\nvec3 gAccumSpecular;\n\nvoid commonLight(in vec4 lightPos,out vec3 lightDir,\nout float diffuseFactor,out float specularFactor){\nvec3 halfVector;\nfloat specularDot;\n\nlightDir=normalize(lightPos.xyz-lightPos.w*gPos);\nhalfVector=normalize(lightDir+gEye);\ndiffuseFactor=max(0.0,dot(gNormal,lightDir));\nspecularDot=max(0.0,dot(gNormal,halfVector));\n\n\nif(diffuseFactor==0.0)\nspecularFactor=0.0;\nelse\nspecularFactor=pow(specularDot,vShininess) *vSpecularReflectiveness;\n}\n\nvec4 flipY(in vec4 v){\nreturn vec4(v.x, -v.y,v.z,v.w);\n}\n\nvoid pointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\n\ngAccumDiffuse +=diffuse*diffuseFactor;\ngAccumSpecular+=specular*specularFactor;\n}\n\nvoid cameraPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(flipY(lightPos),diffuse,specular);\n}\n\nvoid worldPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\npointLight(-uModelViewMatrix*lightPos,diffuse,specular);\n}\n\nvoid spotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nvec3 lightDir;\nfloat diffuseFactor;\nfloat specularFactor;\nvec3 spotDir;\nfloat spotCosAngle;\nfloat spotAttenuation;\n\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\n\nspotDir=lightPos.w*spotPos.xyz-spotPos.w*lightPos.xyz;\nspotCosAngle=dot(-lightDir,normalize(spotDir));\nspotAttenuation=\nstep(spotCosCutoff,spotCosAngle) *pow(spotCosAngle,spotExponent);\n\n\ngAccumDiffuse +=spotAttenuation*diffuse*diffuseFactor;\ngAccumSpecular+=spotAttenuation*specular*specularFactor;\n}\n\nvoid cameraSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\nflipY(lightPos),flipY(spotPos),\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n\nvoid worldSpotLight(\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\nin float spotExponent,in vec3 diffuse,in vec3 specular)\n{\nspotLight(\n-uModelViewMatrix*lightPos, -uModelViewMatrix*spotPos,\nspotCosCutoff,spotExponent,diffuse,specular);\n}\n"+Fa(this.C)+
"\n\n\n\n\n\nvoid shade(in vec3 position,in vec3 normal){\n\ngAccumDiffuse=vec3(0.0);\ngAccumSpecular=vec3(0.0);\n\n\ngPos=position;\ngEye= -normalize(position);\ngNormal=sign(dot(gEye,normal))*normal;\n\n\nlightScene();\n\n\n\nvec3 color= (uAmbient+gAccumDiffuse) *gColor.xyz\n+gAccumSpecular;\n\ncolor=clamp(color,0.0,1.0);\ngl_FragColor=vec4(color.xyz,gColor.w);\n}\n",Ia(this.spheres,this),Ia(this.cylinders,this),Ia(this.triangles,this));if(1===this.g)Ja(this);else{var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,
this.T);Ja(this);a.bindFramebuffer(a.FRAMEBUFFER,null);a.viewport(0,0,this.width,this.height);a.disable(a.DEPTH_TEST);a.bindTexture(a.TEXTURE_2D,this.G);a.generateMipmap(a.TEXTURE_2D);a.bindBuffer(a.ARRAY_BUFFER,this.N);a.enableVertexAttribArray(this.H);a.vertexAttribPointer(this.H,4,a.FLOAT,!1,16,0);this.J.use(a);this.J.uniform.uTexture([0]);a.drawArrays(a.TRIANGLE_STRIP,0,4);a.disableVertexAttribArray(this.H);a.bindTexture(a.TEXTURE_2D,null)}this.gl.flush()};
function Ja(a){var b=a.gl,c="undefined"!==typeof CindyJS._pluginRegistry.CindyLeap,e="undefined"!==typeof CindyJS._pluginRegistry.CindyXR;e||b.viewport(0,0,a.m,a.l);b.clearColor.apply(b,a.backgroundColor);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);a.spheres.s&&a.cylinders.s&&a.triangles.s?(b.disable(b.BLEND),b.depthMask(!0),b.enable(b.DEPTH_TEST)):(b.disable(b.DEPTH_TEST),b.enable(b.BLEND),b.depthMask(!1));var h=1;c?CindyJS._pluginRegistry.CindyLeap.leapPreRender(a.camera):e&&(h=CindyJS._pluginRegistry.CindyXR.xrGetNumViews(),
CindyJS._pluginRegistry.CindyXR.xrPreRender(b,a.camera));for(var m=0;m<h;m++)e&&CindyJS._pluginRegistry.CindyXR.xrUpdateCindy3DCamera(b,m,a.camera),a.spheres.s&&a.cylinders.s&&a.triangles.s?(b.disable(b.BLEND),b.depthMask(!0),b.enable(b.DEPTH_TEST),Ka(a,!0)):(b.disable(b.DEPTH_TEST),b.enable(b.BLEND),b.depthMask(!1),Ka(a,!1),Ka(a,!1),b.depthMask(!0),b.enable(b.DEPTH_TEST),Ka(a,!1));c?CindyJS._pluginRegistry.CindyLeap.leapPostRender(a.camera):e&&CindyJS._pluginRegistry.CindyXR.xrPostRender(b,a.camera);
"undefined"!==typeof a.externalRenderHook&&a.externalRenderHook(b)}function Ka(a,b){b||a.spheres.A(a,1);a.triangles.A(a);a.cylinders.A(a);a.spheres.A(a,-1)}Ca.prototype.h=function(a){a.uProjectionMatrix(this.camera.projectionMatrix);var b=this.camera.mvMatrix;a.uModelViewMatrix([b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]]);b=this.C;a.uAmbient(b.U);for(var c=0;c<b.g.length;++c)b.g[c]&&La(b.g[c],a,c)};function Ha(a,b,c,e){this.canvas=b;this.camera=c;this.m=e;this.l=this.h=Number.NaN;this.g=!1;this.touches=new Map;a(b,"mousedown",this.$.bind(this));a(b,"mousemove",this.ba.bind(this));a(b,"mouseup",this.ca.bind(this));a(b,"mouseleave",this.aa.bind(this));a(b,"wheel",this.ha.bind(this));a(b,"touchstart",this.ga.bind(this));a(b,"touchend",this.ea.bind(this));a(b,"touchcancel",this.da.bind(this));a(b,"touchmove",this.fa.bind(this))}C=Ha.prototype;
C.$=function(a){0===a.button&&(this.g=!0);if(void 0===a.buttons?this.g:a.buttons&1)this.h=a.clientX,this.l=a.clientY};
C.ba=function(a){if(void 0===a.buttons?this.g:a.buttons&1){if(!isNaN(this.h)){var b=a.clientX-this.h,c=a.clientY-this.l;if(a.shiftKey){var e=this.camera,h=-.01*b,m=-.01*c;c=Math.cos(h);b=Math.cos(m);h=Math.sin(h);m=Math.sin(m);var p=[1,0,0,0,0,1,0,0,0,0,1,e.viewDist,0,0,0,1];e.mvMatrix=I(I([c,0,h,0,0,1,0,0,-h,0,c,0,0,0,0,1],[1,0,0,0,0,b,-m,0,0,m,b,0,0,0,0,1]),e.mvMatrix);e.modelMatrix=I(p,e.mvMatrix)}else a.altKey||a.ctrlKey||a.metaKey?ya(this.camera,b,c):xa(this.camera,b,c);this.m.A()}this.h=a.clientX;
this.l=a.clientY}};C.ca=function(a){0===a.button&&(this.g=!1)};C.aa=function(){this.g=!1;this.h=this.l=Number.NaN};C.ha=function(a){var b=a.deltaY;if(b){if(a.shiftKey)Aa(this.camera,-.01*b);else if(a.altKey||a.ctrlKey||a.metaKey){var c=this.camera;c.modelMatrix=I([1,0,0,0,0,1,0,0,0,0,1,-.02*c.viewDist*b,0,0,0,1],c.modelMatrix);c.mvMatrix=I(c.viewMatrix,c.modelMatrix)}else za(this.camera,b);this.m.A()}a.preventDefault()};
C.ga=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b){var c=a[b];this.touches.set(c.identifier,{x:c.clientX,y:c.clientY})}};C.ea=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b)this.touches.delete(a[b].identifier)};C.da=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b)this.touches.delete(a[b].identifier)};
C.fa=function(a){a.preventDefault();var b=a.targetTouches;if(1===b.length){var c=b[0];b=this.touches.get(c.identifier);xa(this.camera,c.clientX-b.x,c.clientY-b.y);this.m.A()}else if(2===b.length){c=b[0];var e=b[1],h=this.touches.get(c.identifier),m=this.touches.get(e.identifier),p=this.canvas.getBoundingClientRect();b=this.canvas.clientLeft+p.left+.5*this.camera.width;p=this.canvas.clientTop+p.top+.5*this.camera.height;var f=.5*(h.x+m.x+1),g=.5*(h.y+m.y+1);ya(this.camera,b-f,p-g);var k=h.x-m.x;h=
h.y-m.y;m=Math.hypot(k,h);var l=Math.atan2(h,k);f=.5*(c.clientX+e.clientX+1);g=.5*(c.clientY+e.clientY+1);k=c.clientX-e.clientX;h=c.clientY-e.clientY;c=Math.atan2(h,k);za(this.camera,m-Math.hypot(k,h));Aa(this.camera,l-c);ya(this.camera,f-b,g-p);this.m.A()}b=a.changedTouches;for(a=0;a<b.length;++a)c=b[a],e=this.touches.get(c.identifier),e.x=c.clientX,e.y=c.clientY};function Da(){this.U=[0,0,0];this.g=[new Ma([0,0,0,1],[1,1,1],[1,1,1])];this.h=!1}function Na(a,b,c){a.h=!c!==!a.g[b]||!!c&&a.g[b].type!==c.type;a.g[b]=c}function Fa(a){for(var b="",c="",e=0;e<a.g.length;++e)a.g[e]&&(b+=Oa(a.g[e],e),c+=Pa(a.g[e],e));return b+"void lightScene() {\n"+c+"}"}function Qa(a,b){this.type=a;this.g=b}Qa.prototype.h={uDiffuse:"vec3",uSpecular:"vec3",uLightPos:"vec4",uSpotPos:"vec4",uSpotCosCutoff:"float",uSpotExponent:"float"};
function Pa(a,b){return"  "+a.type+"("+a.g.map(function(c){return c+b}).join(", ")+");\n"}function Oa(a,b){return a.g.map(function(c){return"uniform "+a.h[c]+" "+c+b+";\n"}).join("")}function La(a,b,c){a.g.forEach(function(e){return b[e+c](a[e])})}function Ma(a,b,c){this.uLightPos=a;this.uDiffuse=b;this.uSpecular=c}Ma.prototype=new Qa("cameraPointLight",["uLightPos","uDiffuse","uSpecular"]);function Ra(a,b,c){this.uLightPos=a;this.uDiffuse=b;this.uSpecular=c}
Ra.prototype=new Qa("worldPointLight",["uLightPos","uDiffuse","uSpecular"]);var Sa={camera:Ma,world:Ra};function Ta(a,b,c,e,h,m){this.uLightPos=a;this.uSpotPos=b;this.uSpotCosCutoff=[c];this.uSpotExponent=[e];this.uDiffuse=h;this.uSpecular=m}Ta.prototype=new Qa("cameraSpotLight","uLightPos uSpotPos uSpotCosCutoff uSpotExponent uDiffuse uSpecular".split(" "));function Ua(a,b,c,e,h,m){this.uLightPos=a;this.uSpotPos=b;this.uSpotCosCutoff=[c];this.uSpotExponent=[e];this.uDiffuse=h;this.uSpecular=m}
Ua.prototype=new Qa("worldSpotLight","uLightPos uSpotPos uSpotCosCutoff uSpotExponent uDiffuse uSpecular".split(" "));var Va={camera:Ta,world:Ua};function Wa(a,b){var c=a.length,e=b.length,h=Math.max.apply(null,b)+1;this.J=a;this.numAttributes=c;this.numVertices=h;this.F=b;this.numElements=e;this.itemLength=4*h*c;this.vertexByteCount=16*c;this.itemAttribByteCount=a=h*this.vertexByteCount;this.itemTotalByteCount=a+e*this.m;this.maxCount=Math.floor(65536/a)}Wa.prototype.m=2;
function Xa(a,b,c){a.mode=b;a.count=0;a.s=!0;a.g=16;a.data=new ArrayBuffer(16*a.itemTotalByteCount);a.dataAttribs=new Float32Array(a.data,0,16*a.itemLength);b=new Uint16Array(a.data,16*a.itemAttribByteCount);a.h=b;var e,h,m=0,p=a.F;for(e=0;16>e;++e){var f=e*a.numVertices;for(h=0;h<p.length;++h)b[m++]=p[h]+f}a.M=c.gl.createBuffer();a.N=c.gl.createBuffer();a.H=-1;a.l=null;Ia(a,c)}
function Ia(a,b){var c=b.gl;null!==a.l&&pa(a.l,c);var e=["precision highp float;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;",a.R].join("\n"),h=["precision highp float;",b.M,a.O].join("\n");b.F&&(h="#extension GL_EXT_frag_depth : enable\n"+h);a.l=new ma(c,e,h);var m=a.l.handle;a.G=a.J.map(function(p){return c.getAttribLocation(m,p)})}
function Ya(a,b){if(b.length!==a.itemLength)throw new E("Wrong number of attributes given");if(a.count==a.g){var c=2*a.g,e,h,m,p=a.F;c>a.maxCount&&(a.g<a.maxCount?c=a.maxCount:(a.m=4,a.itemTotalByteCount=a.itemAttribByteCount+a.numElements*a.m,a.maxCount=Math.floor(Math.pow(2,32)/a.itemAttribByteCount)));var f=new ArrayBuffer(c*a.itemTotalByteCount);var g=new Float32Array(f,0,c*a.itemLength);2===a.m?e=new Uint16Array(f,c*a.itemAttribByteCount):e=new Uint32Array(f,c*a.itemAttribByteCount);g.set(a.dataAttribs);
e.set(a.h);var k=a.h.length;for(h=a.g;h<c;++h){var l=h*a.numVertices;for(m=0;m<p.length;++m)e[k++]=p[m]+l}a.g=c;a.data=f;a.dataAttribs=g;a.h=e}a.dataAttribs.set(b,a.count++*a.itemLength)}
function Za(a,b,c){if(0!==a.count){var e=a.l,h=e.uniform;e.use(b);c(h);b.bindBuffer(b.ARRAY_BUFFER,a.M);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.N);a.H!==a.g?(b.bufferData(b.ARRAY_BUFFER,a.dataAttribs,b.STATIC_DRAW),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.h,b.STATIC_DRAW),a.H=a.g):b.bufferSubData(b.ARRAY_BUFFER,0,new Float32Array(a.data,0,a.count*a.itemLength));for(c=0;c<a.numAttributes;++c)e=a.G[c],b.enableVertexAttribArray(e),b.vertexAttribPointer(e,4,b.FLOAT,!1,a.vertexByteCount,16*c);c=b.UNSIGNED_SHORT;
a.h instanceof Uint32Array&&(c=b.UNSIGNED_INT,b.getExtension("OES_element_index_uint"));b.drawElements(a.mode,a.numElements*a.count,c,0);for(c=0;c<a.numAttributes;++c)b.disableVertexAttribArray(a.G[c])}}Wa.prototype.clear=function(){this.count=0;this.s=!0};function K(a){Xa(this,a.gl.TRIANGLES,a)}K.prototype=new Wa(["aCenter","aColor","aRelativeShininessRadius"],[0,1,2,2,1,3]);K.prototype.R="uniform mat4 uProjectionMatrix;\n\nuniform mat4 uModelViewMatrix;\n\nattribute vec4 aCenter;\n\nattribute vec4 aColor;\n\nattribute vec4 aRelativeShininessRadius;\n\nvarying vec3 vViewSpacePos;\n\nvarying vec3 vViewSpaceCenter;\n\nvarying vec4 vColor;\n\nvarying float vRadius;\n\n\n\n\nvoid main(){\n\nvec4 viewPosHom=uModelViewMatrix*aCenter;\nvViewSpaceCenter=viewPosHom.xyz/viewPosHom.w;\nvec3 dir=normalize(-vViewSpaceCenter);\nvec3 right=normalize(cross(dir,vec3(0,1,0)));\nvec3 up=normalize(cross(right,dir));\n\n\nvColor=aColor;\nvShininess=aRelativeShininessRadius.z;\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\nvRadius=aRelativeShininessRadius.w;\n\n\nvViewSpacePos=vViewSpaceCenter+\nvRadius*(right*aRelativeShininessRadius.x+\nup*aRelativeShininessRadius.y+dir);\n\n\ngl_Position=uProjectionMatrix*vec4(vViewSpacePos,1);\n}\n";
K.prototype.O="uniform mat4 uProjectionMatrix;\n\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\n\nvec3 dir=normalize(ray);\n\n\n\n\nfloat b=dot(center,dir);\nfloat c=dot(center,center) -radius*radius;\nfloat d=b*b-c;\nif(d<0.0)discard;\nfloat lambda=b+face*sqrt(d);\nif(lambda<0.0)discard;\n\n\nreturn lambda*dir;\n}\n\nvoid finish(in vec3 pos,in vec3 normal){\nshade(pos,normal);\n#ifdef GL_EXT_frag_depth\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n#ifdef webgl2\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n}\n\n\nuniform float sphereMode;\n\n\nvarying vec3 vViewSpacePos;\n\nvarying vec3 vViewSpaceCenter;\n\nvarying float vRadius;\n\n\n\n\nvoid main(){\ngColor=vColor;\nvec3 pointOnSphere=\nsphere(vViewSpacePos,vViewSpaceCenter,vRadius,sphereMode);\nvec3 normal=normalize(pointOnSphere-vViewSpaceCenter);\nfinish(pointOnSphere,normal);\n}\n";
K.prototype.add=function(a,b,c){var e=a[0],h=a[1],m=a[2];a=a[3];var p=c.color,f=c.o,g=p[0],k=p[1];p=p[2];c=c.alpha;1>c&&(this.s=!1);Ya(this,[e,h,m,a,g,k,p,c,1,1,f,b,e,h,m,a,g,k,p,c,-1,1,f,b,e,h,m,a,g,k,p,c,1,-1,f,b,e,h,m,a,g,k,p,c,-1,-1,f,b])};K.prototype.A=function(a,b){Za(this,a.gl,function(c){a.h(c);c.sphereMode([b])})};function N(a){Xa(this,a.gl.TRIANGLE_STRIP,a)}N.prototype=new Wa(["aPoint1","aPoint2","aColor","aRelativeRadius","aShininess"],[0,0,2,4,6,7,2,3,1,7,5,4,1,0,2,2]);N.prototype.R="uniform mat4 uProjectionMatrix;\n\nuniform mat4 uModelViewMatrix;\n\nattribute vec4 aPoint1;\n\nattribute vec4 aPoint2;\n\nattribute vec4 aColor;\n\nattribute vec4 aRelativeRadius;\n\nattribute vec4 aShininess;\n\nvarying vec3 vPoint1;\n\nvarying vec3 vPoint2;\n\nvarying vec3 vPos;\n\nvarying vec4 vColor;\n\nvarying float vRadius;\n\n\n\n\nvoid main(){\n\nvec4 hom;\nhom=uModelViewMatrix*aPoint1;\nvPoint1=hom.xyz/hom.w;\nhom=uModelViewMatrix*aPoint2;\nvPoint2=hom.xyz/hom.w;\nvec3 dir=normalize(vPoint2-vPoint1);\n\n\nvec3 d2,d3;\nif(abs(dir.x) <abs(dir.y))\nd2=vec3(1,0,0);\nelse\nd2=vec3(0,1,0);\nd2=normalize(cross(dir,d2));\nd3=normalize(cross(dir,d2));\n\nvPos=aRelativeRadius.w*(mat3(dir,d2,d3)*aRelativeRadius.xyz)\n+0.5*((vPoint2+vPoint1) +aRelativeRadius.x*(vPoint2-vPoint1));\n\n\nvColor=aColor;\nvShininess=aShininess.x;\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\nvRadius=aRelativeRadius.w;\n\n\ngl_Position=uProjectionMatrix*vec4(vPos,1);\n}\n";
N.prototype.O="uniform mat4 uProjectionMatrix;\n\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\n\nvec3 dir=normalize(ray);\n\n\n\n\nfloat b=dot(center,dir);\nfloat c=dot(center,center) -radius*radius;\nfloat d=b*b-c;\nif(d<0.0)discard;\nfloat lambda=b+face*sqrt(d);\nif(lambda<0.0)discard;\n\n\nreturn lambda*dir;\n}\n\nvoid finish(in vec3 pos,in vec3 normal){\nshade(pos,normal);\n#ifdef GL_EXT_frag_depth\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n#ifdef webgl2\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n}\n\nvarying vec3 vPoint1;\n\nvarying vec3 vPoint2;\n\nvarying vec3 vPos;\n\nvarying float vRadius;\n\nvec3 endcaps(in float mu,inout vec3 pos){\nvec3 center;\nif(mu<0.0){\ncenter=vPoint1;\n}else if(mu>1.0){\ncenter=vPoint2;\n}else{\nreturn(1.0-mu)*vPoint1+mu*vPoint2;\n}\npos=sphere(vPos,center,vRadius, -1.0);\nreturn center;\n}\n\n\n\n\nvoid main(){\ngColor=vColor;\n\n\n\nvec3 ba=vPoint2-vPoint1;\nvec3 u=ba/dot(ba,ba);\nvec3 v=vPos-dot(vPos,ba)*u;\nvec3 w=dot(vPoint1,ba)*u-vPoint1;\nfloat a=dot(v,v);\nfloat b=2.0*dot(v,w);\nfloat c=dot(w,w) -vRadius*vRadius;\nfloat d=b*b-4.0*a*c;\nif(d<0.0)\ndiscard;\nfloat lambda= (b+sqrt(d))/(-2.0*a);\nvec3 pointOnSurface=lambda*vPos;\nfloat mu=dot(pointOnSurface-vPoint1,u);\nvec3 center=endcaps(mu,pointOnSurface);\nvec3 normal=normalize(pointOnSurface-center);\nfinish(pointOnSurface,normal);\n}\n";
N.prototype.add=function(a,b,c){var e=a[0],h=a[1],m=a[2];a=a[3];var p=b[0],f=b[1],g=b[2];b=b[3];var k=c.color,l=c.o,d=c.size,n=k[0],q=k[1];k=k[2];c=c.alpha;1>c&&(this.s=!1);Ya(this,[e,h,m,a,p,f,g,b,n,q,k,c,1,1,1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,1,1,-1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,1,-1,1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,1,-1,-1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,-1,1,1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,-1,1,-1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,-1,-1,1,d,l,0,0,0,e,h,m,a,p,f,g,b,n,q,k,c,-1,-1,
-1,d,l,0,0,0])};N.prototype.A=function(a){if(0!==this.count){var b=a.gl;b.enable(b.CULL_FACE);b.cullFace(b.BACK);Za(this,b,a.h.bind(a));b.disable(b.CULL_FACE)}};function Ga(a){Xa(this,a.gl.TRIANGLES,a)}Ga.prototype=new Wa(["aPos","aNormalAndShininess","aColor"],[0,1,2]);C=Ga.prototype;C.R="uniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nattribute vec4 aPos;\nattribute vec4 aNormalAndShininess;\nattribute vec4 aColor;\n\nvarying vec4 vPos;\nvarying vec4 vNormal;\nvarying vec4 vColor;\n\nvoid main(){\nvPos=uModelViewMatrix*aPos;\ngl_Position=uProjectionMatrix*vPos;\nvNormal=uModelViewMatrix*vec4(aNormalAndShininess.xyz,0.0);\nvShininess=aNormalAndShininess.w;\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\nvColor=aColor;\n}\n";
C.O="uniform mat4 uProjectionMatrix;\n\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\n\nvec3 dir=normalize(ray);\n\n\n\n\nfloat b=dot(center,dir);\nfloat c=dot(center,center) -radius*radius;\nfloat d=b*b-c;\nif(d<0.0)discard;\nfloat lambda=b+face*sqrt(d);\nif(lambda<0.0)discard;\n\n\nreturn lambda*dir;\n}\n\nvoid finish(in vec3 pos,in vec3 normal){\nshade(pos,normal);\n#ifdef GL_EXT_frag_depth\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n#ifdef webgl2\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\n#endif\n}\n\nvarying vec4 vPos;\nvarying vec4 vNormal;\n\nuniform bool uTextured;\nuniform sampler2D uTexture;\n\nvoid main(){\nif(uTextured)\ngColor=texture2DProj(uTexture,vColor.xyz);\nelse\ngColor=vColor;\nfinish(vPos.xyz/vPos.w,normalize(vNormal.xyz));\n}\n";
function Q(a,b,c,e,h,m,p,f){var g=f.color,k=f.o,l=g[0],d=g[1];g=g[2];f=f.alpha;1>f&&(a.s=!1);Ya(a,[b[0],b[1],b[2],b[3],h[0],h[1],h[2],k,l,d,g,f,c[0],c[1],c[2],c[3],m[0],m[1],m[2],k,l,d,g,f,e[0],e[1],e[2],e[3],p[0],p[1],p[2],k,l,d,g,f])}function $a(a,b,c,e,h,m,p,f,g,k,l){var d=l.o;l=l.alpha;1>l&&(a.s=!1);Ya(a,[b[0],b[1],b[2],b[3],h[0],h[1],h[2],d,f[0],f[1],f[2],l,c[0],c[1],c[2],c[3],m[0],m[1],m[2],d,g[0],g[1],g[2],l,e[0],e[1],e[2],e[3],p[0],p[1],p[2],d,k[0],k[1],k[2],l])}
function db(a,b,c){if(3==b.length){var e=b[0],h=b[1];b=b[2];var m=va(e,h,b);Q(a,e,h,b,m,m,m,c)}else{e=b.length;var p=Array(e+2);m=[0,0,0];for(h=0;h<e;++h)p[h]=F(b[h]);p[e]=p[0];p[e+1]=p[1];for(h=1;h<=e;++h)m=sa(m,ua(G(p[h],p[h-1]),G(p[h],p[h+1])));if(4==e)Q(a,b[0],b[1],b[3],m,m,m,c),Q(a,b[3],b[1],b[2],m,m,m,c);else{p=[0,0,0,0];var f=b[e-1];for(h=0;h<e;++h)p=ta(p,b[h]);for(h=0;h<e;++h)Q(a,f,b[h],p,m,m,m,c),f=b[h]}}}
function eb(a,b,c,e){if(3==b.length)Q(a,b[0],b[1],b[2],c[0],c[1],c[2],e);else if(4==b.length)Q(a,b[0],b[1],b[3],c[0],c[1],c[3],e),Q(a,b[3],b[1],b[2],c[3],c[1],c[2],e);else{var h=b.length,m,p=[0,0,0,0],f=[0,0,0];for(m=0;m<h;++m)p=ta(p,b[m]),f=sa(f,c[m]);var g=b[h-1],k=c[h-1];for(m=0;m<h;++m)Q(a,g,b[m],p,k,c[m],f,e),g=b[m],k=c[m]}}C.i=null;C.P=null;C.I=null;C.W=null;C.X=null;
C.A=function(a){var b=a.gl;if(this.i){if(this.i.ready){this.i.Z&&this.i.Z();null===this.P&&(this.P=b.createTexture());var c=this.i.width,e=this.i.height;c=fb(c);e=fb(e);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.P);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR);b.hint(b.GENERATE_MIPMAP_HINT,
b.NICEST);if(this.i.live||this.W!==this.i||this.X!==this.i.generation){this.W=this.i;this.X=this.i.generation;var h=this.i.img;if(c!==this.i.width||e!==this.i.height)this.I||(this.I=document.createElement("canvas"),this.I.width=c,this.I.height=e),h=this.I.getContext("2d"),h.clearRect(0,0,c,e),h.drawImage(this.i.img,0,0,c,e),h=this.I;b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,h);b.generateMipmap(b.TEXTURE_2D)}Za(this,b,function(m){a.h(m);m.uTextured([!0]);m.uTexture([0])});b.bindTexture(b.TEXTURE_2D,
null)}}else Za(this,b,function(m){a.h(m);m.uTextured([!1])})};function fb(a){if(0===(a&a-1))return a;for(var b=1;b<a;)b*=2;return b};function R(a){var b=void 0===b?null:b;return"list"!==a.ctype?(console.log("argument is not a list"),b):a.value}function S(a,b,c){b=void 0===b?[0,0,0,0]:b;c=void 0===c?3:c;a=R(a);if(null===a)return b;b=a.map(W);b.length>c+1&&(console.log("Coordinate vector too long."),b=b.slice(0,c+1));for(;b.length<c;)b.push(0);b.length===c&&b.push(1);return b}
function gb(a,b){b=void 0===b?[0,0,0]:b;a=R(a);if(null===a)return b;b=a.map(W);3<b.length&&(console.log("Coordinate vector too long."),b=b.slice(0,3));for(;3>b.length;)b.push(0);return b}function hb(a,b){b=void 0===b?[0,0,0,0]:b;a=gb(a,b);a!==b&&(a[3]=0);return a}function X(a,b){b=void 0===b?[.5,.5,.5]:b;if("number"===a.ctype){var c=Y(0,1,a);if(!isNaN(c))return[c,c,c]}a=R(a);return null===a?b:3!=a.length?(console.log("Not an RGB color vector"),b):a.map(function(e){return Y(0,1,e)})}
function W(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;a=a.value;b=a.real;0!==a.imag&&console.log("complex number is not real");return b}function Z(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;b=a.value;a=b.real;b=b.imag;0!==b&&console.log("complex number is not real");b=Math.round(a);b!==a&&console.log("number is not an integer");return b}
function Y(a,b,c,e){e=void 0===e?Number.NaN:e;c=W(c,e);return c<a?a:c>b?b:c}function ib(a,b){b=void 0===b?null:b;if("string"===a.ctype)return a.value;console.log("argument is not a string");return b}function jb(a,b){var c=["camera","world"];b=void 0===b?null:b;a=ib(a,b);if(a!==b&&-1!==c.indexOf(a))return a;console.log("argument is not one of "+c.join(", "));return b};var kb={};
function lb(a){function b(d,n){var q,u;for(q in d)(u=n[q])?u(g(d[q])):console.log("Modifier "+q+" not supported")}function c(d,n,q){q=void 0===q?null:q;var u=d.color,t=d.alpha,r=d.o,v=d.size;d={color:function(w){return u=X(w)},alpha:function(w){return t=Y(0,1,w)},shininess:function(w){return r=Y(0,128,w)},size:function(w){return v=.05*W(w)}};var x;if(q)for(x in q)d[x]=q[x];b(n,d);return{color:u,alpha:t,o:r,size:v}}function e(d){l.u.alpha=Y(0,1,g(d[0]),1);return f}function h(d,n,q,u,t){for(var r=0,
v=1;v<d;++v){for(var x=1;x<n;++x)t(r,r+1,r+n+1,r+n),++r;q&&t(r,r+1-n,r+1,r+n);++r}if(u){for(d=1;d<n;++d)t(r,r+1,d,d-1),++r;q&&t(r,r+1-n,0,n-1)}}function m(d,n,q,u,t,r,v,x,w){var y=null===v?function(){return w.color}:"perface"===x?function(z){return v[z]}:function(z,O){return v[O]};h(d,n,q,u,function(z,O,T,L){var M=l.triangles;var B=[t[z],t[O],t[T],t[L]],H=[r[z],r[O],r[T],r[L]];z=[y(z,z),y(z,O),y(z,T),y(z,L)];3==B.length?M=$a(M,B[0],B[1],B[2],H[0],H[1],H[2],z[0],z[1],z[2],w):(4==B.length?($a(M,B[0],
B[1],B[3],H[0],H[1],H[3],z[0],z[1],z[3],w),$a(M,B[3],B[1],B[2],H[3],H[1],H[2],z[3],z[1],z[2],w)):console.error("addPolygonWithNormalsAndColors not supported for more than 4 corners"),M=void 0);return M})}function p(d,n){function q(A,U){A=ua(G(A,M),G(U,M));B[0]+=A[0];B[1]+=A[1];B[2]+=A[2];++H}var u=Z(g(d[0])),t=Z(g(d[1])),r=R(g(d[2])).map(function(A){return S(A)}),v="perface",x="pervertex",w="open",y=null,z=null,O=null,T=c(l.u,n,{normaltype:function(A){return v=ib(A,v).toLowerCase()},colortype:function(A){return x=
ib(A,x).toLowerCase()},topology:function(A){return w=ib(A,w).toLowerCase()},colors:function(A){return y=R(A).map(function(U){return X(U)})},uv:function(A){return z=R(A).map(function(U){return S(U,[0,0,0],2)})},texture:function(A){return O=a.getImage(A,!0)}});if(r.length!==u*t)return f;null!==O&&null!=z&&(l.triangles.i=O,l.triangles.s=!1,y=z,x="pervertex");if(null!==y&&y.length!==u*t)return f;n="closerows"===w||"closeboth"===w;var L="closecolumns"===w||"closeboth"===w,M=null,B=null,H=0;if(4===d.length){d=
R(g(d[3])).map(function(A){return gb(A)});if(d.length!==u*t)return f;m(u,t,n,L,r,d,y,x,T)}else if("pervertex"===v){d=Array(u*t);for(var ja=u*t,ka=r.map(F),ba=0,Ea=0;ba<u;++ba)for(var ca=0;ca<t;++ca){var V=Ea+ja;M=ka[Ea];var ab=ka[(V-1)%ja],bb=ka[(V+1)%ja],cb=ka[(V-t)%ja];V=ka[(V+t)%ja];B=[0,0,0];H=0;(L||0<ba)&&(n||0<ca)&&q(ab,cb);(L||ba+1<u)&&(n||0<ca)&&q(V,ab);(L||ba+1<u)&&(n||ca+1<t)&&q(bb,V);(L||0<ba)&&(n||ca+1<t)&&q(cb,bb);d[Ea++]=ra(4/H,B)}m(u,t,n,L,r,d,y,x,T)}else h(u,t,n,L,function(A,U,mb,
nb){return db(l.triangles,[r[A],r[U],r[mb],r[nb]],T)});return f}var f=a.nada,g=a.evaluate,k=a.defineFunction,l;k("begin3d",0,function(d,n){var q="Cindy3D",u={},t={};b(n,{name:function(r){return q=ib(r,q)},antialias:function(r){"boolean"===r.ctype?r=r.value:(console.log("argument is not boolean"),r=!1);return u.antialias=r},supersample:function(r){return t.Y=W(r,1)}});(l=kb[q])||(kb[q]=l=new Ca(q,u,t,a.addAutoCleaningEventListener));l.clear();return f});k("end3d",0,function(){l.A();l=null;return f});
k("gsave3d",0,function(){l.V.push({K:J(l.B),line:J(l.v),L:J(l.u)});return f});k("grestore3d",0,function(){var d=l.V;0<d.length?(d=d.pop(),l.B=d.K,l.v=d.line,l.u=d.L):(l.B=J(P.K),l.v=J(P.line),l.u=J(P.L));return f});k("color3d",1,function(d){if(d=X(g(d[0]),null))l.B.color=d,l.v.color=d,l.u.color=d;return f});k("pointcolor3d",1,function(d){if(d=X(g(d[0]),null))l.B.color=d;return f});k("linecolor3d",1,function(d){if(d=X(g(d[0]),null))l.v.color=d;return f});k("surfacecolor3d",1,function(d){if(d=X(g(d[0]),
null))l.u.color=d;return f});k("alpha3d",1,e);k("surfacealpha3d",1,e);k("shininess3d",1,function(d){d=Y(0,128,g(d[0]));isNaN(d)||(l.B.o=d,l.v.o=d,l.u.o=d);return f});k("pointshininess3d",1,function(d){d=Y(0,128,g(d[0]));isNaN(d)||(l.B.o=d);return f});k("lineshininess3d",1,function(d){d=Y(0,128,g(d[0]));isNaN(d)||(l.v.o=d);return f});k("surfaceshininess3d",1,function(d){d=Y(0,128,g(d[0]));isNaN(d)||(l.u.o=d);return f});k("size3d",1,function(d){d=.05*W(g(d[0]),-1);0<=d&&(l.B.size=d,l.v.size=d);return f});
k("pointsize3d",1,function(d){d=.05*W(g(d[0]),-1);0<=d&&(l.B.size=d);return f});k("linesize3d",1,function(d){d=.05*W(g(d[0]),-1);0<=d&&(l.v.size=d);return f});k("draw3d",1,function(d,n){d=S(g(d[0]));n=c(l.B,n);l.spheres.add(d,n.size,n);return f});k("draw3d",2,function(d,n){var q=S(g(d[0]));d=S(g(d[1]));n=c(l.v,n);l.cylinders.add(q,d,n);return f});k("connect3d",1,function(d,n){d=R(g(d[0]));n=c(l.v,n);if(2>d.length)return f;for(var q=S(d[0]),u=1;u<d.length;++u){var t=S(d[u]);l.cylinders.add(q,t,n);
q=t}return f});k("drawpoly3d",1,function(d,n){d=R(g(d[0]));n=c(l.v,n);if(2>d.length)return f;for(var q=S(d[d.length-1]),u=0;u<d.length;++u){var t=S(d[u]);l.cylinders.add(q,t,n);q=t}return f});k("fillpoly3d",1,function(d,n){d=R(g(d[0]));n=c(l.u,n);if(2>d.length)return f;d=d.map(function(q){return S(q)});db(l.triangles,d,n);return f});k("fillpoly3d",2,function(d,n){var q=R(g(d[0]));d=R(g(d[1]));n=c(l.u,n);if(2>q.length||q.length!=d.length)return f;q=q.map(function(u){return S(u)});d=d.map(function(u){return gb(u)});
eb(l.triangles,q,d,n);return f});k("fillcircle3d",3,function(){return f});k("drawsphere3d",2,function(d,n){var q=S(g(d[0]));d=W(g(d[1]));n=c(l.u,n);l.spheres.add(q,d,n);return f});k("mesh3d",3,function(d,n){return p(d,n)});k("mesh3d",4,function(d,n){return p(d,n)});k("triangle3d",1,function(d,n){d=R(g(d[0])).map(function(x){return S(x)});var q=null,u=null,t=null,r=null;n=c(l.u,n,{colors:function(x){return r=R(x).map(function(w){return X(w)})},uv:function(x){return q=R(x).map(function(w){return S(w,
[0,0,0],2)})},texture:function(x){return u=ib(x)},normals:function(x){return t=R(x).map(function(w){return gb(w)})}});if(!d||3!==d.length)return f;if(null!==u&&null!==q){var v=a.getImage(u);if(!v)return console.log("No such texture image: "+u),f;l.triangles.i=v;l.triangles.s=!1;r=q}if(null!==r&&3!==r.length||null!==t&&3!==t.length)return f;r||(r=[n.color,n.color,n.color]);t||(v=va(d[0],d[1],d[2]),t=[v,v,v]);$a(l.triangles,d[0],d[1],d[2],t[0],t[1],t[2],r[0],r[1],r[2],n);return f});k("background3d",
1,function(d){if(d=X(g(d[0]),null))d.push(1),l.backgroundColor=d;return f});k("lookat3d",3,function(d){var n=S(g(d[0]),null),q=S(g(d[1]),null);d=gb(g(d[2]),null);n&&q&&d&&l.camera.setCamera(F(n),F(q),d);return f});k("fieldofview3d",1,function(d){d=Y(.01,3.13,g(d[0]),0);0<d&&(l.camera.fieldOfView=d,l.camera.updatePerspective());return f});k("depthrange3d",2,function(d){var n=W(g(d[0]),-1);d=W(g(d[1]),-1);0<=n&&d>n&&(l.camera.zNear=n,l.camera.zFar=d,l.camera.updatePerspective());return f});k("renderhints3d",
0,function(){return f});k("pointlight3d",1,function(d,n){d=Z(g(d[0]),0);var q=[0,0,0,1],u=[1,1,1],t=[1,1,1],r="camera";b(n,{position:function(v){return q=S(v,q)},diffuse:function(v){return u=X(v,u)},specular:function(v){return t=X(v,t)},frame:function(v){return r=jb(v,r)}});Na(l.C,d,new Sa[r](q,u,t));return f});k("directionallight3d",1,function(d,n){d=Z(g(d[0]),0);var q=[0,-1,0,0],u=[1,1,1],t=[1,1,1],r="camera";b(n,{direction:function(v){return q=hb(v,q)},diffuse:function(v){return u=X(v,u)},specular:function(v){return t=
X(v,t)},frame:function(v){return r=jb(v,r)}});Na(l.C,d,new Sa[r](q,u,t));return f});k("spotlight3d",1,function(d,n){d=Z(g(d[0]),0);var q=[0,0,0,1],u=[0,-1,0,0],t=Math.PI/4,r=0,v=[1,1,1],x=[1,1,1],w="camera";b(n,{position:function(y){return q=S(y,q)},direction:function(y){return u=hb(y,u)},cutoffangle:function(y){return t=Y(0,Math.PI,y,t)},exponent:function(y){return r=W(y,r)},diffuse:function(y){return v=X(y,v)},specular:function(y){return x=X(y,x)},frame:function(y){return w=jb(y,w)}});Na(l.C,d,
new Va[w](q,u,Math.cos(t),r,v,x));return f});k("disablelight3d",1,function(d){d=Z(g(d[0]),0);Na(l.C,d,null);return f});k("ambientlight3d",1,function(d){if(d=X(g(d[0])))l.C.U=d;return f})}lb.instances=kb;CindyJS.registerPlugin(1,"Cindy3D",lb);
}).call(this);//# sourceMappingURL=Cindy3D.js.map

